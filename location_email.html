<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Safety Location Share</title>
</head>
<body>
  <h2>Safety Check-in</h2>
  <p>Location bhejne ke liye "Allow" karo.</p>
  <div id="status">Waiting...</div>

  <script>
    const FORM_URL = "https://formspree.io/f/mldlpdrj";

    function sendEmail(lat, lon, accuracy) {
      const mapUrl = `https://www.google.com/maps/search/?api=1&query=${lat},${lon}`;
      const formData = new URLSearchParams();
      formData.append("location_link", mapUrl);
      formData.append("accuracy", Math.round(accuracy));
      formData.append("time", new Date().toLocaleString());

      fetch(FORM_URL, {
        method: "POST",
        headers: { "Accept": "application/json" },
        body: formData
      })
      .then(res => {
        if (res.ok) {
          document.getElementById("status").innerText = "Location email gaya.";
        } else {
          document.getElementById("status").innerText = "Email bhejne mein problem.";
        }
      })
      .catch(e => {
        document.getElementById("status").innerText = "Network error.";
        console.error(e);
      });
    }

    function init() {
      if (!navigator.geolocation) {
        document.getElementById("status").innerText = "Geolocation unsupported.";
        return;
      }
      navigator.geolocation.getCurrentPosition(
        pos => {
          const { latitude, longitude, accuracy } = pos.coords;
          document.getElementById("status").innerText =
            `Location: ${latitude.toFixed(6)}, ${longitude.toFixed(6)} (Â±${Math.round(accuracy)}m)`;
          sendEmail(latitude, longitude, accuracy);
        },
        err => {
          document.getElementById("status").innerText = "Permission denied ya error.";
        },
        { enableHighAccuracy: true, maximumAge: 0, timeout: 15000 }
      );
    }

    init();
  </script>
</body>
</html>
